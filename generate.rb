ANALOG = [
  { url: "https://taylorlapeyre.imgix.net/22.jpg", caption: 'Plum blossoms in early spring, Castro SF', framing: 'landscape', title: 'Plum blossoms in early spring, Castro SF' },
  { url: "https://taylorlapeyre.imgix.net/24.jpg", caption: 'Valentines day tuplips on table', framing: 'landscape', title: 'Valentines day tuplips on table' },
  { url: "https://taylorlapeyre.imgix.net/30.jpg", caption: 'Pine leaves in Golden Gate Park in winter', framing: 'landscape', title: 'Pine leaves in Golden Gate Park in winter' },
  { url: "https://taylorlapeyre.imgix.net/31.jpg", caption: 'Greenhouse in the Fort Mason Community Garden, SF', framing: 'landscape', title: 'Greenhouse in the Fort Mason Community Garden, SF' },
  { url: "https://taylorlapeyre.imgix.net/11.jpg", caption: '', framing: 'landscape', title: 'Irrigation in fort mason greenhouse' },
  { url: "https://taylorlapeyre.imgix.net/10.jpg", caption: 'Mount Diablo', framing: 'full-bleed', title: 'Mount Diablo' },
  { url: "https://taylorlapeyre.imgix.net/1.jpg", caption: 'Montata Manzanita, an endemic endangered plant', framing: 'landscape', title: 'Montata Manzanita, an endemic endangered plant species' },
  { url: "https://taylorlapeyre.imgix.net/25.jpg", caption: 'The ecology center at Heron’s Head Park, SF', framing: 'landscape', title: 'The ecology center at Heron’s Head Park, SF' },
  { url: "https://taylorlapeyre.imgix.net/20.jpg", caption: 'Corona Heights', framing: 'full-bleed', title: 'Corona Heights' },
  { url: "https://taylorlapeyre.imgix.net/21.jpg", caption: '', framing: 'landscape', title: 'DMV' },
  { url: "https://taylorlapeyre.imgix.net/16.jpg", caption: 'Sunset Over Cole Valley', framing: 'full-bleed', title: 'Sunset Over Cole Valley, Twin Peaks in foreground' },
  { url: "https://taylorlapeyre.imgix.net/2.jpg", caption: 'The Painted Ladies of Alamo Square', framing: 'portrait', title: 'The Painted Ladies of Alamo Square' },
  { url: "https://taylorlapeyre.imgix.net/29.jpg", caption: 'Sunroom near Alamo Square', framing: 'landscape', title: "Sunroom near Alamo Square" },
  { url: "https://taylorlapeyre.imgix.net/18.jpg", caption: 'Victorian near Buena Vista Park, SF', framing: 'portrait', title: 'Victorian near Buena Vista Park, SF' },
  { url: "https://taylorlapeyre.imgix.net/19.jpg", caption: 'Illuminated MUNI street map at dusk', framing: 'landscape', title: 'Illuminated MUNI street map at dusk' },
  { url: "https://taylorlapeyre.imgix.net/7.jpg", caption: 'View from Nob Hill, SF', framing: 'landscape', title: 'Nob Hill' },
  { url: "https://taylorlapeyre.imgix.net/12.jpg", caption: 'Windows, Steiner St.', framing: 'landscape', title: 'Windows, Steiner St.' },
  { url: "https://taylorlapeyre.imgix.net/32.jpg", caption: '', framing: 'landscape', title: 'Reflection' },
  { url: "https://taylorlapeyre.imgix.net/26.jpg", caption: '', framing: 'landscape', title: 'Peek' },
  { url: "https://taylorlapeyre.imgix.net/23.jpg", caption: 'Jessie & Hiro', framing: 'landscape', title: 'Jessie & Hiro' },
  { url: "https://taylorlapeyre.imgix.net/17.jpg", caption: 'Dinner prep', framing: 'landscape', title: 'Cheese' },
  { url: "https://taylorlapeyre.imgix.net/8.jpg", caption: 'Fishing at Lake Merced', framing: 'landscape', title: 'Fishing at Lake Merced' },
  { url: "https://taylorlapeyre.imgix.net/28.jpg", caption: 'Roofs from houses lining Grandview Park in SF, view of Golden Gate Park', framing: 'full-bleed', title: 'Grandview Roofs' },
  { url: "https://taylorlapeyre.imgix.net/27.jpg", caption: '', framing: 'landscape', title: 'Light Blue House' }
]

DIGITAL = [
  { url: "https://taylorlapeyre.imgix.net/d3.jpg", caption: 'iPhone 7', framing: 'portrait', title: 'Jessie' },
  { url: "https://taylorlapeyre.imgix.net/d2.jpg", caption: 'Sony α5100', framing: 'full-bleed', title: 'After Six' },
  { url: "https://taylorlapeyre.imgix.net/d1.jpg", caption: 'iPhone 7', framing: 'portrait', title: 'Zion' },
  { url: "https://taylorlapeyre.imgix.net/d4.jpg", caption: 'Sony α5100', framing: 'portrait', title: 'SW Corner, Joshua Tree' },
  { url: "https://taylorlapeyre.imgix.net/d5.jpg", caption: 'Sony α7III', framing: 'full-bleed', title: 'Coot' },
  { url: "https://taylorlapeyre.imgix.net/d6.jpg", caption: 'Sony α7III', framing: 'landscape', title: 'Hiro' },
  { url: "https://taylorlapeyre.imgix.net/d7.jpg", caption: 'iPhone X', framing: 'portrait', title: 'El Cap' },
  { url: "https://taylorlapeyre.imgix.net/d15.jpg", caption: 'Sony α5100', framing: 'portrait', title: 'Jessie Shadow' },
  { url: "https://taylorlapeyre.imgix.net/d8.jpg", caption: 'Sony α7III', framing: 'landscape', title: 'California Scrub-Jay' },
  { url: "https://taylorlapeyre.imgix.net/d9.jpg", caption: 'Sony α5100', framing: 'landscape', title: 'Rick' },
  { url: "https://taylorlapeyre.imgix.net/d14.jpg", caption: 'iPhone 7', framing: 'landscape', title: 'Cathedral Peak, Tuolumne' },
  { url: "https://taylorlapeyre.imgix.net/d10.jpg", caption: 'Sony α7III', framing: 'portrait', title: 'Red-Tailed Hawk' },
  { url: "https://taylorlapeyre.imgix.net/d11.jpg", caption: 'Sony α7III', framing: 'full-bleed', title: 'Ocean Beach' },
  { url: "https://taylorlapeyre.imgix.net/d12.jpg", caption: 'Sony α5100', framing: 'landscape', title: 'Alamo Square in Autumn' },
  { url: "https://taylorlapeyre.imgix.net/d13.jpg", caption: 'iPhone X', framing: 'portrait', title: "Plumber's Crack, Red Rock" }
]

def generate_image_tag(image)
  widths = {
    'landscape' => [1400, 700],
    'full-bleed' => [2000, 800],
    'portrait' => [1000, 600]
  }

  classes = {
    'landscape' => '',
    'full-bleed' => 'full-bleed',
    'portrait' => 'vertical'
  }

  widths_for_image = widths[image[:framing]]
  class_for_image = classes[image[:framing]]

  %Q{
    <figure class="#{class_for_image} photo-container">
      <picture>
        <source
          media="(min-width: 992px)"
          srcset="#{image[:url]}?w=#{widths_for_image[0]}"
        />
        <source
          media="(max-width: 992px)"
          srcset="#{image[:url]}?w=#{widths_for_image[1]}"
        />
        <img
          alt="#{image[:title]}"
          class="photo"
          loading="lazy"
          src="#{image[:url]}"
        />
      </picture>
      <figcaption class="photo-caption">
        #{image[:caption]}
      </figcaption>
    </figure>
  }

end

index = File.read('index.template.html')

generated_index =
  index
  .gsub(/<section id="analog" class="tab-content page-container">(.?|\n)*?<\/section>/, %Q{
    <section id="analog" class="tab-content page-container">
      #{ANALOG.map { |image| generate_image_tag(image) }.join('')}
    </section>
  })
  .gsub(/<section id="digital" class="tab-content page-container">(.?|\n)*?<\/section>/, %Q{
    <section id="digital" class="tab-content page-container">
      #{DIGITAL.map { |image| generate_image_tag(image) }.join('')}
    </section>
  })

File.write('index.html', generated_index)